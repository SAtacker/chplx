#
# This program file was generated by the chplx compiler.
# The original Chapel program file can be found here: "heat.chpl"
#
cmake_minimum_required(VERSION 3.19)
if(NOT CMAKE_BUILD_TYPE)
  set(CMAKE_BUILD_TYPE Debug CACHE STRING "Configuration type" FORCE)
endif()
project(heat)
add_executable(heat heat.cpp heat_driver.cpp)
if(NOT APPLE)
  set(CMAKE_CXX_STANDARD 20)
endif()
if(NOT WIN32 AND ${CMAKE_CXX_COMPILER_ID} STREQUAL "Clang" AND NOT APPLE)
  set(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} -stdlib=libc++)
endif()
if(NOT Chplx_DIR)
  message(FATAL_ERROR "Chplx_DIR variable undefined")
endif()
set_property(GLOBAL PROPERTY USE_FOLDERS ON)
find_package(fmt REQUIRED CONFIG)
find_package(HPX REQUIRED CONFIG)
find_package(Chplx REQUIRED CONFIG)
set(heat_sources heat.cpp heat_driver.cpp)
set(heat_headers heat.hpp heat_driver.hpp)
if(NOT WIN32 AND ${CMAKE_CXX_COMPILER_ID} STREQUAL "Clang" AND APPLE)
  find_library(CORE_LIBPATH NAMES CoreFoundation REQUIRED)
  target_compile_options(heat
    PUBLIC
    -nostdlib
    -std=c++23
    -Ofast
    -ffast-math
    -stdlib=libc++
    -mllvm -global-isel
  )
  target_link_libraries(heat PRIVATE ${CORE_LIBPATH})
  target_link_libraries(heat
    PUBLIC
    c++
  )
endif()
target_link_libraries(heat PUBLIC fmt::fmt-header-only HPX::hpx Chplx::library)
enable_testing()
include(CTest)
add_test(
  NAME heat_test
  COMMAND heat
  WORKING_DIRECTORY $<TARGET_FILE_DIR:heat>
)
